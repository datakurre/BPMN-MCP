<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:process id="Process_Conference_Registration" name="Conference Registration Process" isExecutable="true" camunda:historyTimeToLive="P180D">
    <bpmn:startEvent id="StartEvent_Registration" name="Registration Started">
      <bpmn:outgoing>Flow_Start_to_EnterDetails</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="UserTask_EnterDetails" name="Enter Personal Details">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="name" label="Full Name" type="string">
            <camunda:validation>
              <camunda:constraint name="required" />
            </camunda:validation>
          </camunda:formField>
          <camunda:formField id="email" label="Email Address" type="string">
            <camunda:validation>
              <camunda:constraint name="required" />
            </camunda:validation>
          </camunda:formField>
          <camunda:formField id="affiliation" label="Affiliation/Organization" type="string" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_Start_to_EnterDetails</bpmn:incoming>
      <bpmn:outgoing>Flow_EnterDetails_to_CheckOpen</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="Gateway_RegistrationOpen" name="Registration Open?" default="Flow_Open_to_SelectTicket">
      <bpmn:incoming>Flow_EnterDetails_to_CheckOpen</bpmn:incoming>
      <bpmn:outgoing>Flow_Closed</bpmn:outgoing>
      <bpmn:outgoing>Flow_Open_to_SelectTicket</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="EndEvent_Closed" name="Registration Closed">
      <bpmn:incoming>Flow_Closed</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:userTask id="UserTask_SelectTicket" name="Select Ticket Type">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="ticketType" label="Ticket Type" type="enum">
            <camunda:value id="standard" name="Standard - $100" />
            <camunda:value id="student" name="Student - $50" />
            <camunda:value id="vip" name="VIP - $200" />
          </camunda:formField>
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_Open_to_SelectTicket</bpmn:incoming>
      <bpmn:outgoing>Flow_SelectTicket_to_EnterPayment</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:userTask id="UserTask_EnterPayment" name="Enter Payment Details">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="cardNumber" label="Card Number" type="string">
            <camunda:validation>
              <camunda:constraint name="required" />
            </camunda:validation>
          </camunda:formField>
          <camunda:formField id="expiry" label="Expiry Date" type="string">
            <camunda:validation>
              <camunda:constraint name="required" />
            </camunda:validation>
          </camunda:formField>
          <camunda:formField id="cvv" label="CVV" type="string">
            <camunda:validation>
              <camunda:constraint name="required" />
            </camunda:validation>
          </camunda:formField>
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_SelectTicket_to_EnterPayment</bpmn:incoming>
      <bpmn:outgoing>Flow_EnterPayment_to_ProcessPayment</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="ServiceTask_ProcessPayment" name="Process Payment" camunda:type="external" camunda:topic="payment-service">
      <bpmn:incoming>Flow_EnterPayment_to_ProcessPayment</bpmn:incoming>
      <bpmn:outgoing>Flow_ProcessPayment_to_CheckResult</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_PaymentResult" name="Payment Successful?" default="Flow_PaymentOK">
      <bpmn:incoming>Flow_ProcessPayment_to_CheckResult</bpmn:incoming>
      <bpmn:outgoing>Flow_PaymentFailed</bpmn:outgoing>
      <bpmn:outgoing>Flow_PaymentOK</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="EndEvent_PaymentFailed" name="Payment Failed">
      <bpmn:incoming>Flow_PaymentFailed</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:parallelGateway id="Gateway_SplitConfirmation" name="Confirmation Tasks">
      <bpmn:incoming>Flow_PaymentOK</bpmn:incoming>
      <bpmn:outgoing>Flow_Split_to_Email</bpmn:outgoing>
      <bpmn:outgoing>Flow_Split_to_DB</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:serviceTask id="ServiceTask_SendEmail" name="Send Confirmation Email" camunda:type="external" camunda:topic="email-service">
      <bpmn:incoming>Flow_Split_to_Email</bpmn:incoming>
      <bpmn:outgoing>Flow_Email_to_Join</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:serviceTask id="ServiceTask_UpdateDB" name="Update Database" camunda:type="external" camunda:topic="db-service">
      <bpmn:incoming>Flow_Split_to_DB</bpmn:incoming>
      <bpmn:outgoing>Flow_DB_to_Join</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:parallelGateway id="Gateway_JoinConfirmation" name="Join Confirmation">
      <bpmn:incoming>Flow_Email_to_Join</bpmn:incoming>
      <bpmn:incoming>Flow_DB_to_Join</bpmn:incoming>
      <bpmn:outgoing>Flow_Join_to_End</bpmn:outgoing>
    </bpmn:parallelGateway>
    <bpmn:endEvent id="EndEvent_Complete" name="Registration Complete">
      <bpmn:incoming>Flow_Join_to_End</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_Start_to_EnterDetails" sourceRef="StartEvent_Registration" targetRef="UserTask_EnterDetails" />
    <bpmn:sequenceFlow id="Flow_EnterDetails_to_CheckOpen" sourceRef="UserTask_EnterDetails" targetRef="Gateway_RegistrationOpen" />
    <bpmn:sequenceFlow id="Flow_Closed" sourceRef="Gateway_RegistrationOpen" targetRef="EndEvent_Closed">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!registrationOpen}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_Open_to_SelectTicket" sourceRef="Gateway_RegistrationOpen" targetRef="UserTask_SelectTicket" />
    <bpmn:sequenceFlow id="Flow_SelectTicket_to_EnterPayment" sourceRef="UserTask_SelectTicket" targetRef="UserTask_EnterPayment" />
    <bpmn:sequenceFlow id="Flow_EnterPayment_to_ProcessPayment" sourceRef="UserTask_EnterPayment" targetRef="ServiceTask_ProcessPayment" />
    <bpmn:sequenceFlow id="Flow_ProcessPayment_to_CheckResult" sourceRef="ServiceTask_ProcessPayment" targetRef="Gateway_PaymentResult" />
    <bpmn:sequenceFlow id="Flow_PaymentFailed" sourceRef="Gateway_PaymentResult" targetRef="EndEvent_PaymentFailed">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${!paymentSuccessful}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_PaymentOK" sourceRef="Gateway_PaymentResult" targetRef="Gateway_SplitConfirmation" />
    <bpmn:sequenceFlow id="Flow_Split_to_Email" sourceRef="Gateway_SplitConfirmation" targetRef="ServiceTask_SendEmail" />
    <bpmn:sequenceFlow id="Flow_Split_to_DB" sourceRef="Gateway_SplitConfirmation" targetRef="ServiceTask_UpdateDB" />
    <bpmn:sequenceFlow id="Flow_Email_to_Join" sourceRef="ServiceTask_SendEmail" targetRef="Gateway_JoinConfirmation" />
    <bpmn:sequenceFlow id="Flow_DB_to_Join" sourceRef="ServiceTask_UpdateDB" targetRef="Gateway_JoinConfirmation" />
    <bpmn:sequenceFlow id="Flow_Join_to_End" sourceRef="Gateway_JoinConfirmation" targetRef="EndEvent_Complete" />
    <bpmn:dataObjectReference id="DataObject_RegistrationData" name="Registration Data" dataObjectRef="DataObject_1" />
    <bpmn:dataObject id="DataObject_1" />
    <bpmn:dataStoreReference id="DataStore_ConferenceDB" name="Conference DB" />
    <bpmn:association id="Association_Details_to_Data" sourceRef="UserTask_EnterDetails" targetRef="DataObject_RegistrationData" />
    <bpmn:association id="Association_DB_to_Store" sourceRef="ServiceTask_UpdateDB" targetRef="DataStore_ConferenceDB" />
    <bpmn:textAnnotation id="Annotation_PaymentNote">
      <bpmn:text>Payment processing is handled by an external service</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_PaymentNote" sourceRef="ServiceTask_ProcessPayment" targetRef="Annotation_PaymentNote" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_Conference_Registration">
      <bpmndi:BPMNShape id="StartEvent_Registration_di" bpmnElement="StartEvent_Registration">
        <dc:Bounds x="162" y="232" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="147" y="275" width="66" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_EnterDetails_di" bpmnElement="UserTask_EnterDetails">
        <dc:Bounds x="250" y="210" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_RegistrationOpen_di" bpmnElement="Gateway_RegistrationOpen" isMarkerVisible="true">
        <dc:Bounds x="405" y="225" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="393" y="282" width="74" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Closed_di" bpmnElement="EndEvent_Closed">
        <dc:Bounds x="502" y="142" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="483" y="118" width="74" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_SelectTicket_di" bpmnElement="UserTask_SelectTicket">
        <dc:Bounds x="510" y="210" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_EnterPayment_di" bpmnElement="UserTask_EnterPayment">
        <dc:Bounds x="660" y="210" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_ProcessPayment_di" bpmnElement="ServiceTask_ProcessPayment">
        <dc:Bounds x="810" y="210" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_PaymentResult_di" bpmnElement="Gateway_PaymentResult" isMarkerVisible="true">
        <dc:Bounds x="965" y="225" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="948" y="195" width="84" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_PaymentFailed_di" bpmnElement="EndEvent_PaymentFailed">
        <dc:Bounds x="1072" y="142" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1053" y="118" width="74" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_SplitConfirmation_di" bpmnElement="Gateway_SplitConfirmation">
        <dc:Bounds x="1065" y="310" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1043" y="367" width="94" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_SendEmail_di" bpmnElement="ServiceTask_SendEmail">
        <dc:Bounds x="1170" y="383" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_UpdateDB_di" bpmnElement="ServiceTask_UpdateDB">
        <dc:Bounds x="1170" y="253" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_JoinConfirmation_di" bpmnElement="Gateway_JoinConfirmation">
        <dc:Bounds x="1325" y="355" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1305" y="412" width="90" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Complete_di" bpmnElement="EndEvent_Complete">
        <dc:Bounds x="1432" y="362" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1413" y="405" width="74" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataObject_RegistrationData_di" bpmnElement="DataObject_RegistrationData">
        <dc:Bounds x="282" y="105" width="36" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="260" y="81" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="DataStore_ConferenceDB_di" bpmnElement="DataStore_ConferenceDB">
        <dc:Bounds x="1195" y="165" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1188" y="148" width="74" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Annotation_PaymentNote_di" bpmnElement="Annotation_PaymentNote">
        <dc:Bounds x="850" y="110" width="180" height="40" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_Start_to_EnterDetails_di" bpmnElement="Flow_Start_to_EnterDetails">
        <di:waypoint x="198" y="250" />
        <di:waypoint x="250" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_EnterDetails_to_CheckOpen_di" bpmnElement="Flow_EnterDetails_to_CheckOpen">
        <di:waypoint x="350" y="250" />
        <di:waypoint x="405" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Closed_di" bpmnElement="Flow_Closed">
        <di:waypoint x="430" y="225" />
        <di:waypoint x="430" y="160" />
        <di:waypoint x="502" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Open_to_SelectTicket_di" bpmnElement="Flow_Open_to_SelectTicket">
        <di:waypoint x="455" y="250" />
        <di:waypoint x="510" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_SelectTicket_to_EnterPayment_di" bpmnElement="Flow_SelectTicket_to_EnterPayment">
        <di:waypoint x="610" y="250" />
        <di:waypoint x="660" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_EnterPayment_to_ProcessPayment_di" bpmnElement="Flow_EnterPayment_to_ProcessPayment">
        <di:waypoint x="760" y="250" />
        <di:waypoint x="810" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_ProcessPayment_to_CheckResult_di" bpmnElement="Flow_ProcessPayment_to_CheckResult">
        <di:waypoint x="910" y="250" />
        <di:waypoint x="965" y="250" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_PaymentFailed_di" bpmnElement="Flow_PaymentFailed">
        <di:waypoint x="990" y="225" />
        <di:waypoint x="990" y="160" />
        <di:waypoint x="1072" y="160" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_PaymentOK_di" bpmnElement="Flow_PaymentOK">
        <di:waypoint x="990" y="275" />
        <di:waypoint x="990" y="335" />
        <di:waypoint x="1065" y="335" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Split_to_Email_di" bpmnElement="Flow_Split_to_Email">
        <di:waypoint x="1090" y="360" />
        <di:waypoint x="1090" y="423" />
        <di:waypoint x="1170" y="423" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Split_to_DB_di" bpmnElement="Flow_Split_to_DB">
        <di:waypoint x="1090" y="310" />
        <di:waypoint x="1090" y="293" />
        <di:waypoint x="1170" y="293" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Email_to_Join_di" bpmnElement="Flow_Email_to_Join">
        <di:waypoint x="1270" y="423" />
        <di:waypoint x="1298" y="423" />
        <di:waypoint x="1298" y="388" />
        <di:waypoint x="1325" y="388" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_DB_to_Join_di" bpmnElement="Flow_DB_to_Join">
        <di:waypoint x="1270" y="293" />
        <di:waypoint x="1298" y="293" />
        <di:waypoint x="1298" y="372" />
        <di:waypoint x="1325" y="372" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Join_to_End_di" bpmnElement="Flow_Join_to_End">
        <di:waypoint x="1375" y="380" />
        <di:waypoint x="1432" y="380" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_Details_to_Data_di" bpmnElement="Association_Details_to_Data">
        <di:waypoint x="300" y="210" />
        <di:waypoint x="300" y="155" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_DB_to_Store_di" bpmnElement="Association_DB_to_Store">
        <di:waypoint x="1220" y="253" />
        <di:waypoint x="1220" y="215" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_PaymentNote_di" bpmnElement="Association_PaymentNote">
        <di:waypoint x="860" y="210" />
        <di:waypoint x="860" y="150" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
