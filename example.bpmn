<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:collaboration id="Collaboration_18frgne">
    <bpmn:participant id="Participant_1eofrr5" name="Order Fulfillment" processRef="Process_Diagram_5_Full_Executable_Order_Processing" />
  </bpmn:collaboration>
  <bpmn:process id="Process_Diagram_5_Full_Executable_Order_Processing" name="Diagram 5: Full Executable Order Processing" isExecutable="true" camunda:historyTimeToLive="P180D">
    <bpmn:laneSet id="LaneSet_05z63qn">
      <bpmn:lane id="Lane_1tnlv45" name="Customer">
        <bpmn:flowNodeRef>StartEvent_OrderSubmitted</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>UserTask_ReviewOrder</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_OrderCompleted</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>EndEvent_OrderCancelled</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_0a8towe" name="Sales">
        <bpmn:flowNodeRef>ServiceTask_ValidatePriceOrder</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_StockAvailable</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>UserTask_NotifyCustomerBackorder</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_0wqvyt8" name="Warehouse">
        <bpmn:flowNodeRef>UserTask_PickPackItems</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>ServiceTask_GenerateShippingLabel</bpmn:flowNodeRef>
      </bpmn:lane>
      <bpmn:lane id="Lane_074t95g" name="Finance">
        <bpmn:flowNodeRef>ServiceTask_ProcessPayment</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>Gateway_PaymentOK</bpmn:flowNodeRef>
        <bpmn:flowNodeRef>ServiceTask_SendConfirmationEmail</bpmn:flowNodeRef>
      </bpmn:lane>
    </bpmn:laneSet>
    <bpmn:sequenceFlow id="Flow_ReviewOrder_to_ValidatePriceOrder" sourceRef="UserTask_ReviewOrder" targetRef="ServiceTask_ValidatePriceOrder" />
    <bpmn:sequenceFlow id="Flow_NotifyCustomerBackorder_to_OrderCancelled" sourceRef="UserTask_NotifyCustomerBackorder" targetRef="EndEvent_OrderCancelled" />
    <bpmn:sequenceFlow id="Flow_Yes" name="Yes" sourceRef="Gateway_StockAvailable" targetRef="UserTask_PickPackItems">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${stockAvailable == true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_GenerateShippingLabel_to_ProcessPayment" sourceRef="ServiceTask_GenerateShippingLabel" targetRef="ServiceTask_ProcessPayment" />
    <bpmn:sequenceFlow id="Flow_Failed" name="Failed" sourceRef="Gateway_PaymentOK" targetRef="EndEvent_OrderCancelled">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${paymentStatus == 'FAILED'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_SendConfirmationEmail_to_OrderCompleted" sourceRef="ServiceTask_SendConfirmationEmail" targetRef="EndEvent_OrderCompleted" />
    <bpmn:startEvent id="StartEvent_OrderSubmitted" name="Order Submitted">
      <bpmn:outgoing>Flow_OrderSubmitted_to_ReviewOrder</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:userTask id="UserTask_ReviewOrder" name="Review Order" camunda:candidateGroups="customer">
      <bpmn:incoming>Flow_OrderSubmitted_to_ReviewOrder</bpmn:incoming>
      <bpmn:outgoing>Flow_ReviewOrder_to_ValidatePriceOrder</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:endEvent id="EndEvent_OrderCompleted" name="Order Completed">
      <bpmn:incoming>Flow_SendConfirmationEmail_to_OrderCompleted</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="EndEvent_OrderCancelled" name="Order Cancelled">
      <bpmn:incoming>Flow_NotifyCustomerBackorder_to_OrderCancelled</bpmn:incoming>
      <bpmn:incoming>Flow_Failed</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_OrderSubmitted_to_ReviewOrder" sourceRef="StartEvent_OrderSubmitted" targetRef="UserTask_ReviewOrder" />
    <bpmn:serviceTask id="ServiceTask_ValidatePriceOrder" name="Validate &#38; Price Order" camunda:asyncBefore="true" camunda:type="external" camunda:topic="order-validate">
      <bpmn:incoming>Flow_ReviewOrder_to_ValidatePriceOrder</bpmn:incoming>
      <bpmn:outgoing>Flow_ValidatePriceOrder_to_StockAvailable</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_StockAvailable" name="Stock Available?">
      <bpmn:incoming>Flow_ValidatePriceOrder_to_StockAvailable</bpmn:incoming>
      <bpmn:outgoing>Flow_No</bpmn:outgoing>
      <bpmn:outgoing>Flow_Yes</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:userTask id="UserTask_NotifyCustomerBackorder" name="Notify Customer - Backorder" camunda:candidateGroups="sales">
      <bpmn:incoming>Flow_No</bpmn:incoming>
      <bpmn:outgoing>Flow_NotifyCustomerBackorder_to_OrderCancelled</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_ValidatePriceOrder_to_StockAvailable" sourceRef="ServiceTask_ValidatePriceOrder" targetRef="Gateway_StockAvailable" />
    <bpmn:sequenceFlow id="Flow_No" name="No" sourceRef="Gateway_StockAvailable" targetRef="UserTask_NotifyCustomerBackorder">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${stockAvailable == false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="UserTask_PickPackItems" name="Pick &#38; Pack Items" camunda:candidateGroups="warehouse">
      <bpmn:incoming>Flow_Yes</bpmn:incoming>
      <bpmn:outgoing>Flow_PickPackItems_to_GenerateShippingLabel</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:serviceTask id="ServiceTask_GenerateShippingLabel" name="Generate Shipping Label" camunda:asyncBefore="true" camunda:type="external" camunda:topic="shipping-label">
      <bpmn:incoming>Flow_PickPackItems_to_GenerateShippingLabel</bpmn:incoming>
      <bpmn:outgoing>Flow_GenerateShippingLabel_to_ProcessPayment</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_PickPackItems_to_GenerateShippingLabel" sourceRef="UserTask_PickPackItems" targetRef="ServiceTask_GenerateShippingLabel" />
    <bpmn:serviceTask id="ServiceTask_ProcessPayment" name="Process Payment" camunda:asyncBefore="true" camunda:type="external" camunda:topic="payment-process">
      <bpmn:incoming>Flow_GenerateShippingLabel_to_ProcessPayment</bpmn:incoming>
      <bpmn:outgoing>Flow_ProcessPayment_to_PaymentOK</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_PaymentOK" name="Payment OK?">
      <bpmn:incoming>Flow_ProcessPayment_to_PaymentOK</bpmn:incoming>
      <bpmn:outgoing>Flow_Failed</bpmn:outgoing>
      <bpmn:outgoing>Flow_Success</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="ServiceTask_SendConfirmationEmail" name="Send Confirmation Email" camunda:type="external" camunda:topic="email-send">
      <bpmn:incoming>Flow_Success</bpmn:incoming>
      <bpmn:outgoing>Flow_SendConfirmationEmail_to_OrderCompleted</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_ProcessPayment_to_PaymentOK" sourceRef="ServiceTask_ProcessPayment" targetRef="Gateway_PaymentOK" />
    <bpmn:sequenceFlow id="Flow_Success" name="Success" sourceRef="Gateway_PaymentOK" targetRef="ServiceTask_SendConfirmationEmail">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${paymentStatus == 'SUCCESS'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_18frgne">
      <bpmndi:BPMNShape id="Participant_1eofrr5_di" bpmnElement="Participant_1eofrr5" isHorizontal="true">
        <dc:Bounds x="-300" y="40" width="1734" height="1135" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_1tnlv45_di" bpmnElement="Lane_1tnlv45" isHorizontal="true">
        <dc:Bounds x="-270" y="40" width="1704" height="219" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0a8towe_di" bpmnElement="Lane_0a8towe" isHorizontal="true">
        <dc:Bounds x="-270" y="259" width="1704" height="159" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_0wqvyt8_di" bpmnElement="Lane_0wqvyt8" isHorizontal="true">
        <dc:Bounds x="-270" y="418" width="1704" height="379" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Lane_074t95g_di" bpmnElement="Lane_074t95g" isHorizontal="true">
        <dc:Bounds x="-270" y="797" width="1704" height="378" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_OrderSubmitted_di" bpmnElement="StartEvent_OrderSubmitted">
        <dc:Bounds x="162" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="140" y="201" width="81" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_ReviewOrder_di" bpmnElement="UserTask_ReviewOrder">
        <dc:Bounds x="248" y="140" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_OrderCompleted_di" bpmnElement="EndEvent_OrderCompleted">
        <dc:Bounds x="1348" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1324" y="201" width="85" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_OrderCancelled_di" bpmnElement="EndEvent_OrderCancelled">
        <dc:Bounds x="798" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="776" y="201" width="81" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_ValidatePriceOrder_di" bpmnElement="ServiceTask_ValidatePriceOrder">
        <dc:Bounds x="398" y="299" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_StockAvailable_di" bpmnElement="Gateway_StockAvailable" isMarkerVisible="true">
        <dc:Bounds x="548" y="314" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="456" y="332" width="82" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_NotifyCustomerBackorder_di" bpmnElement="UserTask_NotifyCustomerBackorder">
        <dc:Bounds x="648" y="299" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_PickPackItems_di" bpmnElement="UserTask_PickPackItems">
        <dc:Bounds x="648" y="568" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_GenerateShippingLabel_di" bpmnElement="ServiceTask_GenerateShippingLabel">
        <dc:Bounds x="798" y="568" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_ProcessPayment_di" bpmnElement="ServiceTask_ProcessPayment">
        <dc:Bounds x="948" y="946" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_PaymentOK_di" bpmnElement="Gateway_PaymentOK" isMarkerVisible="true">
        <dc:Bounds x="1098" y="961" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1089" y="1014" width="69" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_SendConfirmationEmail_di" bpmnElement="ServiceTask_SendConfirmationEmail">
        <dc:Bounds x="1198" y="946" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_0zg9sqe_di" bpmnElement="Flow_ReviewOrder_to_ValidatePriceOrder">
        <di:waypoint x="348" y="180" />
        <di:waypoint x="373" y="180" />
        <di:waypoint x="373" y="339" />
        <di:waypoint x="398" y="339" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0gy2c5s_di" bpmnElement="Flow_NotifyCustomerBackorder_to_OrderCancelled">
        <di:waypoint x="748" y="339" />
        <di:waypoint x="773" y="339" />
        <di:waypoint x="773" y="180" />
        <di:waypoint x="798" y="180" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_13jac20_di" bpmnElement="Flow_Yes">
        <di:waypoint x="573" y="364" />
        <di:waypoint x="573" y="608" />
        <di:waypoint x="648" y="608" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="564" y="520" width="19" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1k9yn1v_di" bpmnElement="Flow_GenerateShippingLabel_to_ProcessPayment">
        <di:waypoint x="898" y="608" />
        <di:waypoint x="923" y="608" />
        <di:waypoint x="923" y="986" />
        <di:waypoint x="948" y="986" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_119qheu_di" bpmnElement="Flow_Failed">
        <di:waypoint x="1123" y="961" />
        <di:waypoint x="1123" y="180" />
        <di:waypoint x="834" y="180" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1108" y="408" width="30" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_12z9q07_di" bpmnElement="Flow_SendConfirmationEmail_to_OrderCompleted">
        <di:waypoint x="1298" y="986" />
        <di:waypoint x="1323" y="986" />
        <di:waypoint x="1323" y="180" />
        <di:waypoint x="1348" y="180" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1i6k1fc_di" bpmnElement="Flow_OrderSubmitted_to_ReviewOrder">
        <di:waypoint x="180" y="162" />
        <di:waypoint x="180" y="100" />
        <di:waypoint x="298" y="100" />
        <di:waypoint x="298" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0niitzr_di" bpmnElement="Flow_ValidatePriceOrder_to_StockAvailable">
        <di:waypoint x="448" y="299" />
        <di:waypoint x="448" y="159" />
        <di:waypoint x="120" y="159" />
        <di:waypoint x="120" y="169" />
        <di:waypoint x="573" y="169" />
        <di:waypoint x="573" y="314" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1svydfj_di" bpmnElement="Flow_No">
        <di:waypoint x="598" y="339" />
        <di:waypoint x="648" y="339" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="616" y="332" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0adtpu8_di" bpmnElement="Flow_PickPackItems_to_GenerateShippingLabel">
        <di:waypoint x="719" y="568" />
        <di:waypoint x="848" y="323" />
        <di:waypoint x="848" y="568" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0cck2xj_di" bpmnElement="Flow_ProcessPayment_to_PaymentOK">
        <di:waypoint x="998" y="946" />
        <di:waypoint x="998" y="606" />
        <di:waypoint x="120" y="606" />
        <di:waypoint x="120" y="616" />
        <di:waypoint x="1123" y="616" />
        <di:waypoint x="1123" y="961" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1koe0f1_di" bpmnElement="Flow_Success">
        <di:waypoint x="1148" y="986" />
        <di:waypoint x="1198" y="986" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1152" y="979" width="42" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
